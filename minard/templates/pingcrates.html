{% extends "layout.html" %}
{% block title %}Ping Crates{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
{% block body %}
  {{ super() }}

<div class="container">
  <h2 align="left">Information For the User</h2>
    <table class="table table-hover">
      <tr class="success"> <th> If the run status is "Pass" the N100 and N20 trigger signals look good for all crates and slots! </th> </tr>
      <tr class="danger"> <th>  If the run status is "Fail" note it in the shift report and the shift slack. No immediate action is needed, but it might be a data quality issue. </th> </tr>
      <tr class="warning"> <th> If the run status is "Warn" a detector expert will take a look. No action is needed. </th> </tr>
  </table>
</div>

<div class="page-header">
  <h1 align="center">Ping Crates</h1>
</div>


<div class="container">
  <table class="table table-hover">
    <thead>
      <tr> 
        <th> Run Number </th>
        <th> Status </th>
        <th> Crates Failed N100 </th>
        <th> Crates Failed N20 </th>
        <th> Run Type </th>
        <th> Time Run Was Processed </th>
        <th> Comment </th>
        <th> Expert </th>
      </tr>
    </thead>
    {% for run in runs if run %}
      {% if run.status == "Fail" %}
        <tr class="danger">
      {% elif run.status == "Pass" %}
        <tr class="success">
      {% elif run.status == "Warn" %}
        <tr class="warning">
      {% endif %}
        <th><a href="{{url_for('pingcrates_run',run_number=run.run_number) }}">{{run.run_number}}</a></th>
        <th> {{run.status}} </th> 
        <th> {{run.n100_crates_failed}} </th>
        <th> {{run.n20_crates_failed}} </th>
        <th> {{run.run_type}} </th>
        <th> {{run.time|timefmt}} </th>
        {% if run.comment %}
          <th> {{run.comment}} </th>
          <th> {{run.expert}} </th>
        {% else %}
          <th> <input type="text" id="comment" style="width: 80px;"> </th>
          <th> <input type="text" id="expert" style="width: 80px;"> </th>
        {% endif %}
      </tr>
    {% endfor %}
  </table>
</div>

{% endblock %}
{% block script %}
<script>
    document.getElementById("comment")
        .addEventListener("keyup", function(event) {
         if(event.keyCode == 13){
            update_comment();
        }
    });
    document.getElementById("expert")
        .addEventListener("keyup", function(event) {
         if(event.keyCode == 13){
            update_comment();
        }
    });
    function update_comment() {
        var params = {};
        params['comment'] = document.getElementById("comment").value;
        window.location.replace($SCRIPT_ROOT + "/pingcrates?" + $.param(params));
    }
</script>
{% endblock %}
